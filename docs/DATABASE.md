# Database Schema

Below are the MySQL table definitions generated by the JPA entities.

## campus
```sql
CREATE TABLE campus (
    id_campus INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(60) NOT NULL UNIQUE
);
```

## tag
```sql
CREATE TABLE tag (
    id_tag INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(60) UNIQUE
);
```

## grupo
```sql
CREATE TABLE grupo (
    id_grupo VARCHAR(36) PRIMARY KEY,
    nombre VARCHAR(120) UNIQUE,
    descripcion TEXT,
    imagen_url VARCHAR(250),
    id_campus INT,
    FOREIGN KEY (id_campus) REFERENCES campus(id_campus)
);
```

## grupo_miembro
```sql
CREATE TABLE grupo_miembro (
    id_grupo VARCHAR(36),
    id_usuario VARCHAR(36),
    rol_grupo ENUM('USUARIO','REPRESENTANTE') NOT NULL,
    PRIMARY KEY (id_grupo, id_usuario),
    FOREIGN KEY (id_grupo) REFERENCES grupo(id_grupo),
    FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario)
);
```

## grupo_tag
```sql
CREATE TABLE grupo_tag (
    id_grupo VARCHAR(36) NOT NULL,
    id_tag INT NOT NULL,
    PRIMARY KEY (id_grupo, id_tag),
    FOREIGN KEY (id_grupo) REFERENCES grupo(id_grupo),
    FOREIGN KEY (id_tag) REFERENCES tag(id_tag)
);
```

## usuario
```sql
CREATE TABLE usuario (
    id_usuario VARCHAR(36) PRIMARY KEY,
    correo_ubb VARCHAR(120) NOT NULL UNIQUE,
    nombres VARCHAR(80) NOT NULL,
    apellidos VARCHAR(80) NOT NULL,
    username VARCHAR(80) UNIQUE,
    id_campus VARCHAR(36),
    password VARCHAR(255),
    estado ENUM('ACTIVO','INACTIVO') NOT NULL,
    created_at DATETIME
);
```

## usuario_rol
```sql
CREATE TABLE usuario_rol (
    id_usuario VARCHAR(36) NOT NULL,
    id_rol INT NOT NULL,
    PRIMARY KEY (id_usuario, id_rol),
    FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario),
    FOREIGN KEY (id_rol) REFERENCES role(id_rol)
);
```

## role
```sql
CREATE TABLE role (
    id_rol INT AUTO_INCREMENT PRIMARY KEY,
    nombre ENUM('ALUMNO','DOCENTE','EXTERNO','MODERADOR','ADMINISTRADOR') UNIQUE
);
```

## evento
```sql
CREATE TABLE evento (
    id_evento VARCHAR(36) PRIMARY KEY,
    origen_tipo ENUM('USUARIO','GRUPO','OTRO'),
    id_grupo VARCHAR(36),
    id_creador VARCHAR(36) NOT NULL,
    titulo VARCHAR(180) NOT NULL,
    descripcion TEXT,
    fecha_inicio DATETIME NOT NULL,
    fecha_fin DATETIME NOT NULL,
    lugar VARCHAR(120),
    aforo_max INT,
    visibilidad ENUM('PUBLICO','PRIVADO'),
    estado_validacion ENUM('PENDIENTE','APROBADO','RECHAZADO'),
    FOREIGN KEY (id_grupo) REFERENCES grupo(id_grupo),
    FOREIGN KEY (id_creador) REFERENCES usuario(id_usuario)
);
```

## evento_revision
```sql
CREATE TABLE evento_revision (
    id_evento VARCHAR(36) PRIMARY KEY,
    id_mod VARCHAR(36),
    estado ENUM('APROBADO','RECHAZADO') NOT NULL,
    comentario VARCHAR(250),
    rev_ts DATETIME,
    FOREIGN KEY (id_evento) REFERENCES evento(id_evento),
    FOREIGN KEY (id_mod) REFERENCES usuario(id_usuario)
);
```

## amistad
```sql
CREATE TABLE amistad (
    id_usr1 VARCHAR(36),
    id_usr2 VARCHAR(36),
    estado ENUM('PENDIENTE','ACEPTADA','BLOQUEADA') NOT NULL,
    PRIMARY KEY (id_usr1, id_usr2),
    FOREIGN KEY (id_usr1) REFERENCES usuario(id_usuario),
    FOREIGN KEY (id_usr2) REFERENCES usuario(id_usuario)
);
```

## inscripcion
```sql
CREATE TABLE inscripcion (
    id_evento VARCHAR(36),
    id_usuario VARCHAR(36),
    estado ENUM('INSCRITO','CANCELADO','ASISTIO') NOT NULL,
    PRIMARY KEY (id_evento, id_usuario),
    FOREIGN KEY (id_evento) REFERENCES evento(id_evento),
    FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario)
);
```

## ticket_soporte
```sql
CREATE TABLE ticket_soporte (
    id_ticket VARCHAR(36) PRIMARY KEY,
    id_reporter VARCHAR(36),
    descripcion TEXT,
    estado ENUM('ABIERTO','CERRADO') NOT NULL,
    FOREIGN KEY (id_reporter) REFERENCES usuario(id_usuario)
);
```

## trofeo
```sql
CREATE TABLE trofeo (
    id_trofeo INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(80) UNIQUE
);
```

## usuario_trofeo
```sql
CREATE TABLE usuario_trofeo (
    id_usuario VARCHAR(36),
    id_trofeo INT,
    obt_en DATETIME,
    PRIMARY KEY (id_usuario, id_trofeo),
    FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario),
    FOREIGN KEY (id_trofeo) REFERENCES trofeo(id_trofeo)
);
```

## token
```sql
CREATE TABLE token (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    access_token VARCHAR(255) UNIQUE,
    token_type ENUM('BEARER'),
    revoked BOOLEAN,
    expired BOOLEAN,
    user_id VARCHAR(36),
    FOREIGN KEY (user_id) REFERENCES usuario(id_usuario)
);
```

